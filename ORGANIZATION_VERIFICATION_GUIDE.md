# 組織アカウント認証ガイド（管理者向け）

## 📋 現在の認証フロー

### 1. 組織アカウントの登録
組織アカウントが登録されると：
- プロフィールが作成される
- `verification_status`が`'pending'`（審査中）に設定される
- 認証申請（`organization_verification_requests`）が自動作成される（改善後）

### 2. 管理者による認証

#### 方法1: 認証申請タブから認証（推奨）

1. **管理者ダッシュボードにアクセス**
   - ヘッダーのユーザーメニューから「管理者ダッシュボード」をクリック
   - または `/admin` に直接アクセス

2. **認証申請タブを開く**
   - 「認証申請」タブをクリック
   - 認証待ちの申請一覧が表示される

3. **申請の詳細を確認**
   - 各申請の「詳細」ボタンをクリック
   - 以下の情報を確認：
     - 組織名
     - 申請者情報
     - 担当者情報
     - 組織URL（あれば）
     - 申請理由（あれば）

4. **認証を承認または拒否**
   - **承認する場合**:
     - 審査メモを入力（任意）
     - 「承認」ボタンをクリック
     - プロフィールの`verification_status`が`'verified'`に更新される
   - **拒否する場合**:
     - 拒否理由を審査メモに入力（推奨）
     - 「拒否」ボタンをクリック
     - プロフィールの`verification_status`が`'rejected'`に更新される

#### 方法2: ユーザー管理タブから認証（今後実装予定）

1. **ユーザー管理タブを開く**
   - 「ユーザー管理」タブをクリック

2. **組織アカウントを検索**
   - アカウントタイプで「教育機関」「企業」「政府機関」を選択
   - 認証ステータスで「審査中」を選択
   - 検索ボタンをクリック

3. **認証状態を変更**
   - 各ユーザーの「認証状態を変更」ボタンをクリック
   - 承認または拒否を選択

## 🔍 認証の判断基準

### 承認すべきケース
- ✅ 組織名が明確で、実在する組織である
- ✅ 担当者情報が正確である
- ✅ メールアドレスが組織のドメインである（推奨）
- ✅ 申請理由が適切である

### 拒否すべきケース
- ❌ 組織名が不明確または虚偽である
- ❌ 担当者情報が不正確である
- ❌ スパムや不正利用の疑いがある
- ❌ 申請理由が不適切である

## 📊 認証状態の意味

- **`pending`（審査中）**: 認証申請が提出され、審査待ちの状態
- **`verified`（認証済み）**: 認証が完了し、組織用機能が利用可能
- **`rejected`（拒否）**: 認証が拒否された状態
- **`unverified`（未認証）**: 個人アカウントのデフォルト状態

## ⚠️ 注意事項

1. **認証は慎重に行う**
   - 組織アカウントは公式投稿などの重要な機能が利用可能になるため、慎重に審査する

2. **審査メモを記録する**
   - 承認・拒否の理由を審査メモに記録しておくと、後で確認できる

3. **定期的に確認する**
   - 認証待ちの申請がないか定期的に確認する
   - 通常1-3営業日以内に審査を完了する

## 🛠️ トラブルシューティング

### 認証申請が表示されない場合
1. 組織アカウントが正しく登録されているか確認
2. `organization_verification_requests`テーブルにデータが存在するか確認
3. データベースのRLSポリシーが正しく設定されているか確認

### 認証が反映されない場合
1. ブラウザをリフレッシュする
2. ユーザーがログアウト・ログインし直す
3. データベースで直接`verification_status`を確認する


